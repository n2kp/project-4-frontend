<!DOCTYPE html >
<div class="main">


  <div class="row justify-content-center">
    <div class="col-5  ">

      <div class="projectInfo projectCards">
        <p> Posted by {{ projectsShow.project.user.username }}</p>
        <h2 class="marginBottomMd"> {{ projectsShow.project.title }}</h2>
        <p>{{ projectsShow.project.description }}</p>
        <p><span> Project deadline: </span> {{ projectsShow.project.project_deadline | date }}</p>
        <p><span> Time left to bid: </span>{{ projectsShow.project.bid_deadline | amDifference : null : 'days' }} days </p>
        <p><span> Tech Stack </span>{{ projectsShow.project.tech_stack }}</p>
        <p><span> Budget: </span>{{ projectsShow.project.budget | currency : '£' : 0}}</p>
        <br>

        <button ng-click="projectsShow.contactCreator(main.currentUser.id, projectsShow.project.user.id)" class="button primary">
          Message {{ projectsShow.project.user.username}}</button>

          <button ui-sref="profile({ id: projectsShow.project.user.id })" class="button primary">Posted by {{ projectsShow.project.user.username }}</button>

          <button ui-sref="projectsEdit({ id: projectsShow.project.id})" ng-if="main.currentUser.id === projectsShow.project.user.id">Edit</button>

        </div>
      </div>

      <div class="col-5 marginTopLg">
        <form ng-if="!projectsShow.findUsersTender(main.currentUser.id) && main.currentUser.is_dev" ng-submit="projectsShow.tenderCreate()">

          <h3>There are currently {{ projectsShow.project.tenders.length }} bids on this project, make your offer here...</h3>


          <label for="bid">Bid</label>
          <input type="number" id="tenderBid" name="tenderBid" ng-model="projectsShow.tender.bid">

          <label for="pitch">Pitch</label>
          <input type="text" id="tenderPitch" name="tenderPitch" ng-model="projectsShow.tender.pitch">

          <label for="base64">Image Upload</label>
          <input type="file" base64 id="base64" name="base64" ng-model="projectsShow.tender.base64">

          <button class="button primary">Submit Offer</button>
        </form>



        <h1>Current Bids</h1>

        <div ng-repeat="tender in projectsShow.project.tenders" class="projectCards" id="noPaddingBottom">

        



          <div ng-if="main.currentUser.id === tender.user.id || main.currentUser.id === projectsShow.project.user.id || !main.currentUser.is_dev">


            <div class="tenderInfo">



              <h1 ng-if="main.currentUser.id === tender.user.id ">Your current bid</h1>
              <h2 class="marginBottomMd">{{ tender.user.firstname }}'s offer</h2>
              <h5>{{ tender.bid  | currency : '£' : 0 }}</h5>
              <h5>{{ tender.pitch }}</h5>



              <div ng-class="{blue:tender.status === 'pending', red:tender.status === 'rejected', green:tender.status === 'accepted'}"> {{ tender.status }} </div>

              <h5>{{ tender.user.status }}</h5>
              <!-- <p> {{ tender }}</p> -->
              <div ng-if="tender.image_src !== null">
                <img ng-src="{{ tender.image_src }}">
              </div>
            </div>





              <button ng-if="main.currentUser.id === tender.user.id"  ng-click="projectsShow.show = 1">Alter your bid</button>

              <div ng-show="projectsShow.show == 1">
                <form ng-submit="projectsShow.tenderUpdate()">

                  <label for="bid">Bid</label>
                  <input type="number" id="bid" name="bid" ng-model="tender.bid">

                  <label for="pitch">Pitch</label>
                  <input type="text" id="pitch" name="pitch" ng-model="tender.pitch">

                  <label for="image_src">Image Upload</label>
                  <input type="text" id="image_src" name="image_src" ng-model="tender.image_src">

                  <button class="button primary">Submit Offer</button>

                </form>
                <button ng-click="projectsShow.show = 0" class="button primary">Cancel</button>
              </div>

            </div>


            <div class="row justify-content-center">


              <div ng-if="main.currentUser.id === projectsShow.project.user.id" ng-click="projectsShow.acceptBid(tender.id) ; contactCreator(main.currentUser.id, projectsShow.tender.user.id)" class="cursor justify-content-center acceptBox">


                <div class="bidAccept">
                  <i class="material-icons">done</i>
                </div>
                <h4 class="text-center">Accept this bid</h4>
              </div>



              <h4 ng-if="main.currentUser.id === tender.user.id" ng-click="projectsShow.delete(tender)">Retract your bid</h4>


              <div ng-if="main.currentUser.id === projectsShow.project.user.id" ng-click="projectsShow.delete(tender)" class="cursor acceptBox">


                <div class="bidReject">
                  <i class="material-icons">clear</i>
                </div>
                <h4 class="text-center">Reject this bid</h4>


              </div>
            </div>

            <button ng-if="main.currentUser.id === projectsShow.project.user.id && tender.status === 'pending'" ng-click="projectsShow.acceptBid(tender.id) ; contactCreator(main.currentUser.id, projectsShow.tender.user.id)">Accept this bid</button>

            <button ng-if="main.currentUser.id === tender.user.id" ng-click="projectsShow.delete(tender)">Retract your bid</button>

            <button ng-if="main.currentUser.id === projectsShow.project.user.id && tender.status !== 'accepted' && tender.status !== 'rejected' " ng-click="projectsShow.rejectBid(tender.id)">Reject this bid</button>

          </div>
        </div>
      </div>
    </div>
