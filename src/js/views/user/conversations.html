<!DOCTYPE html >

<div class="main">

  <div class="row justify-content-center">
    <div class="row col-11 chatBoxBounding">

      <div class="col-3 chatList">
        <div class="chatHeading">

          <img ng-src="{{ main.currentUser.image_src }}" alt="profile.user.image" class="NavProfileImage">
        </div>

        <div ng-repeat="conversation in conversations.conversations track by $index">

          <div class="col-sm-12" id="chatSidebarMessages">
            <div ng-click="conversations.selectConversation(conversation, $index)" class="cursor">
              <div class="row" id="zero">

                <div class="col-2 marginRightSm">
                  <img ng-src="{{ conversation.receiver.username  === main.currentUser.username ? conversation.sender.username : conversation.receiver.username }}" alt="profile.user.imageSRC" class=" chatProfileImage">
                </div>

                <div class="col-sm-8">
                  <h4> {{ conversation.receiver.username  === main.currentUser.username ? conversation.sender.username : conversation.receiver.username }}</h4>
                  <div ng-repeat="message in conversation.messages track by $index">

                    <div ng-if="(conversation.messages.length-1) === $index">
                      <p id="greyText"> {{ message.body | limitTo: 55 }}... </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!--
      <p ng-show="conversations.index === null" class="col-4 red"> Please select a conversation </p> -->

      <!-- CONVERSATION -->
      <div class="col-9 messageside">
        <div ng-show="conversations.index !== null" class="col-12 messageScroll">

          <div ng-repeat="message in conversations.conversations[conversations.index].messages" class="speech-bubble-row">



              <div ng-class="{true:'speech-bubble-sent', false:'speech-bubble-received'}[main.currentUser.id === message.user_id]">
                <div class="body">
                <p>  {{ message.body }} </p>
                </div><div class="small">{{ message.created_at | date : 'shortTime' }} </div>
            </div>
          </div>
        </div>

        <!-- <div class="col-9 messageside">
        <ul>
        <li class="speech-bubble-sent"><span>Hi its tim!</span></li>
        <li class="speech-bubble-received"><span>Yo, s'up tim!</span></li>
      </ul>
    </div> -->

    <!-- WRITE A MESSAGE SECTION -->
    <div class="col-12 chatInput">
      <div class="chatPadding">

        <form ng-show="conversations.index !== null" ng-submit="conversations.addMessage(conversations.message)" name="conversations.messageForm">

          <label for="body">Write a message... </label>
          <input type="text" ng-model="conversations.message.body" name="body" id="body" required>
          <button>Submit</button>

        </form>
      </div>
    </div>
  </div>
</div>
</div>
</div>
